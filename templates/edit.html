<!DOCTYPE html>
<html>
<head>
    <title>Edit Cylinder</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <h2>✏️ Edit Cylinder Name and Size</h2>
    <button type="button" onclick="startScanner()">📷 Scan QR Code</button>
    <div id="reader" style="width: 300px; margin-top: 15px;"></div>


    <form method="POST">
        <label>Scan or Enter Barcode:</label><br>
        <input type="text" name="barcode" id="barcode" required autofocus value="{{ cylinder.barcode if cylinder else '' }}">
        <button type="submit" name="search">🔍 Search</button>
        <br><br>

        {% if cylinder %}
            <label>New Name (Gas Type):</label><br>
            <input type="text" name="gas_type" value="{{ cylinder.gas_type }}" required><br><br>

            <label>New Size:</label><br>
            <input type="text" name="size" value="{{ cylinder.size }}" required><br><br>

            <button type="submit" name="save">💾 Save Changes</button>
        {% endif %}
    </form>

    <br>
    <a href="/">🏠 Home</a> |
    <a href="/cylinders">📋 View All</a>
<script>
  function startScanner() {
    const html5QrCode = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(devices => {
  if (devices && devices.length) {
    // Try to find a front-facing camera
    let frontCam = devices.find(device => 
      device.label.toLowerCase().includes("front") || 
      device.label.toLowerCase().includes("user")
    );

    const cameraId = frontCam ? frontCam.id : devices[0].id;

    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      cameraId,
      {
        fps: 10,
        qrbox: 250
      },
      qrCodeMessage => {
        document.getElementById('barcode').value = qrCodeMessage;
        html5QrCode.stop();
        document.getElementById('reader').innerHTML = '';
      },
      errorMessage => {
        // ignore read errors
      }
    ).catch(err => {
      console.error("Unable to start scanning", err);
    });
  }
}).catch(err => {
  console.error("Camera access denied or not found", err);
});

  }
</script>

    
</body>
</html>
